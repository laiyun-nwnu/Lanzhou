<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>汉字详情 - 兰州地名学习</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #3a5a40;
      --secondary-color: #a3b18a;
      --accent-color: #588157;
      --light-color: #dad7cd;
      --dark-color: #344e41;
    }
    body {
      font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
      background-color: #f8f9fa;
    }
    .navbar {
      background-color: var(--primary-color);
    }
    .navbar-brand, .nav-link {
      color: white !important;
    }
    .character-header {
      background-color: var(--secondary-color);
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
    }
    .character-display {
      font-size: 5rem;
      font-weight: bold;
      line-height: 1.2;
      margin-bottom: 0.5rem;
    }
    .place-card {
      border: none;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      height: 100%;
    }
    .place-card:hover {
      transform: translateY(-5px);
    }
    .hsk-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      margin-right: 0.5rem;
      font-size: 0.8rem;
      font-weight: bold;
    }
    .hsk-1 { background-color: #e6f7ff; color: #0050b3; }
    .hsk-2 { background-color: #d9f7be; color: #237804; }
    .hsk-3 { background-color: #fff7e6; color: #ad6800; }
    .hsk-4 { background-color: #fff1f0; color: #a8071a; }
    .hsk-5 { background-color: #f9f0ff; color: #531dab; }
    .hsk-6 { background-color: #e6fffb; color: #006d75; }
    .hsk-unknown { background-color: #f5f5f5; color: #595959; }
    .stroke-order {
      max-width: 100%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 5px;
      background-color: white;
    }
    footer {
      background-color: var(--dark-color);
      color: white;
      padding: 2rem 0;
      margin-top: 3rem;
    }
    .audio-btn {
      cursor: pointer;
    }
    .debug-info {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <!-- 导航栏 -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">兰州地名学习</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">首页</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#network">地名网络</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#hsk-levels">HSK级别</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html#about">关于项目</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 调试信息 -->
  <div class="container mt-3" id="debug-container" style="display: none;">
    <div class="debug-info" id="debug-info">
      <h5>调试信息</h5>
      <p>URL: <span id="debug-url"></span></p>
      <p>汉字参数: <span id="debug-param"></span></p>
    </div>
  </div>

  <!-- 汉字头部 -->
  <header class="character-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <div class="character-display" id="character-display">加载中...</div>
          <h1 id="character-pinyin">拼音加载中...</h1>
          <div class="mt-2" id="character-badges">
            <!-- 徽章将通过JavaScript动态插入 -->
          </div>
        </div>
        <div class="col-md-6 text-end">
          <button class="btn btn-light me-2 audio-btn" id="pronounce-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-up" viewBox="0 0 16 16">
              <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
              <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
              <path d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4z"/>
            </svg>
            发音
          </button>
          <a href="index.html#hsk-levels" class="btn btn-outline-light">返回HSK级别</a>
        </div>
      </div>
    </div>
  </header>

  <!-- 主要内容 -->
  <main class="container">
    <!-- 汉字详细信息 -->
    <section class="mb-5">
      <div class="row">
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header">
              <h2 class="h5 mb-0">基本信息</h2>
            </div>
            <div class="card-body">
              <table class="table table-borderless">
                <tr>
                  <th style="width: 30%">拼音：</th>
                  <td id="info-pinyin">加载中...</td>
                </tr>
                <tr>
                  <th>HSK级别：</th>
                  <td id="info-hsk">加载中...</td>
                </tr>
                <tr>
                  <th>笔画数：</th>
                  <td id="info-strokes">加载中...</td>
                </tr>
                <tr>
                  <th>部首：</th>
                  <td id="info-radical">加载中...</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header">
              <h2 class="h5 mb-0">笔顺</h2>
            </div>
            <div class="card-body text-center">
              <div id="stroke-order-container">
                <!-- 笔顺图将通过JavaScript动态插入 -->
                <p>加载中...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 包含该汉字的地名 -->
    <section class="mb-5">
      <h2 class="text-center mb-4">包含"<span id="char-in-title">...</span>"的地名</h2>
      <div class="row" id="related-places-container">
        <!-- 相关地名卡片将通过JavaScript动态插入 -->
        <div class="col-12 text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p>加载中...</p>
        </div>
      </div>
    </section>

    <!-- 学习提示 -->
    <section class="mb-5">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h2 class="h5 mb-0">学习提示</h2>
        </div>
        <div class="card-body" id="learning-tips">
          <p>加载中...</p>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <h5>兰州地名学习</h5>
          <p>面向国际中文教学的地名学习平台</p>
        </div>
        <div class="col-md-3">
          <h5>链接</h5>
          <ul class="list-unstyled">
            <li><a href="index.html" class="text-white">首页</a></li>
            <li><a href="index.html#network" class="text-white">地名网络</a></li>
            <li><a href="index.html#hsk-levels" class="text-white">HSK级别</a></li>
            <li><a href="index.html#about" class="text-white">关于项目</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5>联系我们</h5>
          <ul class="list-unstyled">
            <li>邮箱: info@lanzhouplace.edu</li>
            <li>电话: +86 123 4567 8910</li>
          </ul>
        </div>
      </div>
      <hr class="bg-white">
      <div class="text-center">
        <p>&copy; 2025 兰州地名学习平台. 保留所有权利.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function getHSKBadge(level) {
      // level可以是"一级"/"二级"/数字，返回对应徽章class
      const map = {
        '一级': 'hsk-1',
        '二级': 'hsk-2',
        '三级': 'hsk-3',
        '四级': 'hsk-4',
        '五级': 'hsk-5',
        '六级': 'hsk-6',
        1: 'hsk-1',
        2: 'hsk-2',
        3: 'hsk-3',
        4: 'hsk-4',
        5: 'hsk-5',
        6: 'hsk-6'
      };
      return map[level] || 'hsk-unknown';
    }

    async function loadCharacterDetail() {
      const char = getQueryParam('char');
      document.getElementById('char-in-title').innerText = char || '...';

      // 调试信息（可选显示）
      if (location.search.includes('debug')) {
        document.getElementById('debug-container').style.display = '';
        document.getElementById('debug-url').innerText = location.href;
        document.getElementById('debug-param').innerText = char;
      }

      if (!char) return;

      // 读取JSON
      let data;
      try {
        const res = await fetch('character_detail.json');
        data = await res.json();
      } catch (e) {
        document.getElementById('character-display').innerText = '数据加载失败';
        return;
      }

      const info = data[char];
      if (!info) {
        // 未收录处理
        document.getElementById('character-display').innerText = '未收录';
        document.getElementById('character-pinyin').innerText = '-';
        document.getElementById('info-pinyin').innerText = '-';
        document.getElementById('info-hsk').innerText = '-';
        document.getElementById('info-strokes').innerText = '-';
        document.getElementById('info-radical').innerText = '-';
        document.getElementById('stroke-order-container').innerHTML = '<p>暂无笔顺动画</p>';
        document.getElementById('related-places-container').innerHTML =
          '<div class="col-12 text-center"><p>暂无相关地名</p></div>';
        document.getElementById('learning-tips').innerText = '暂无学习提示';
        return;
      }

      // 基本信息渲染
      document.getElementById('character-display').innerText = char;
      document.getElementById('character-pinyin').innerText = info.pinyin || '-';
      document.getElementById('info-pinyin').innerText = info.pinyin || '-';
      document.getElementById('info-hsk').innerHTML =
        `<span class="hsk-badge ${getHSKBadge(info.level)}">${info.level || '-'}</span>`;
      document.getElementById('info-strokes').innerText = info.strokes || '-';
      document.getElementById('info-radical').innerText = info.radical || '-';

      // 笔顺动画
      if (info.stroke_gif) {
        document.getElementById('stroke-order-container').innerHTML =
          `<img src="${info.stroke_gif}" alt="笔顺动画" class="stroke-order"/>`;
      } else {
        document.getElementById('stroke-order-container').innerHTML = '<p>暂无笔顺动画</p>';
      }

      // 发音按钮
      document.getElementById('pronounce-btn').onclick = () => {
        if(info.audio){
          const audio = new Audio(info.audio);
          audio.play();
        }
      };

      // 相关地名（如有）
      if(info.places && info.places.length > 0) {
        document.getElementById('related-places-container').innerHTML =
          info.places.map(place => `
            <div class="col-md-3 mb-3">
              <div class="card place-card">
                <div class="card-body text-center">
                  <h5 class="card-title">${place}</h5>
                </div>
              </div>
            </div>
          `).join('');
      } else {
        document.getElementById('related-places-container').innerHTML =
          '<div class="col-12 text-center"><p>暂无相关地名</p></div>';
      }

      // 学习提示（如有）
      document.getElementById('learning-tips').innerText = info.tips || '暂无学习提示';
    }

    window.onload = loadCharacterDetail;
  </script>
</body>
</html>
